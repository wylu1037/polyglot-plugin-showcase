# 差分隐私插件演示

## 🎬 快速演示

### 1. 构建插件
```bash
cd /path/to/polyglot-plugin-showcase
make plugin-dpanonymizer
```

### 2. 运行示例程序
```bash
make plugin-example-dpanonymizer
```

## 📊 演示场景

### 场景 1: 保护用户计数隐私

**问题**: 你想发布网站的访问用户数，但不想泄露某个特定用户是否访问过。

**解决方案**: 使用差分隐私计数

```bash
# 实际用户数: 1000
# 使用 ε=1.0 的差分隐私
# 输出: 约 1000 ± 噪声
```

**隐私保证**: 即使攻击者知道其他 999 个用户的信息，也无法确定第 1000 个用户是否访问过。

### 场景 2: 发布平均年龄

**问题**: 发布用户平均年龄，但保护个人隐私。

**解决方案**: 使用差分隐私均值

```go
ages := []float64{25, 30, 35, 40, 45, 50}
// 实际均值: 37.5
// DP 均值 (ε=1.0): 约 37.5 ± 噪声
```

**隐私保证**: 无法推断任何单个用户的年龄。

### 场景 3: 工资统计

**问题**: 发布部门总工资，但不泄露个人工资信息。

**解决方案**: 使用差分隐私求和

```go
salaries := []float64{50000, 60000, 70000, 80000, 90000}
// 实际总和: 350,000
// DP 总和 (ε=1.0): 约 350,000 ± 噪声
// 边界: [0, 200,000] (单人工资上限)
```

## 🔬 实验对比

### 不同 Epsilon 值的影响

| Epsilon | 隐私级别 | 噪声大小 | 示例输出 (真实值=100) |
|---------|---------|---------|---------------------|
| 0.1     | 非常强   | 很大     | 85 - 115           |
| 0.5     | 强       | 大       | 92 - 108           |
| 1.0     | 中等     | 中等     | 96 - 104           |
| 3.0     | 弱       | 小       | 98 - 102           |

### Laplace vs Gaussian 噪声

**Laplace (纯 ε-DP)**:
- 更简单的隐私保证
- 无需 δ 参数
- 相同 ε 下噪声稍大

**Gaussian ((ε,δ)-DP)**:
- 稍弱的隐私保证（有 δ）
- 相同 ε 下噪声更小
- 更适合多次查询

## 💡 实用技巧

### 1. 选择合适的 Epsilon

```go
// 高度敏感数据（医疗记录）
epsilon := 0.1

// 个人数据（年龄、收入）
epsilon := 0.5 - 1.0

// 一般统计数据
epsilon := 1.0 - 3.0
```

### 2. 设置合理的边界

```go
// ❌ 错误: 边界太宽
"lower_bound": "0.0",
"upper_bound": "1000000.0",  // 年龄不可能这么大

// ✅ 正确: 根据实际数据设置
"lower_bound": "0.0",
"upper_bound": "120.0",  // 合理的年龄上限
```

### 3. 隐私预算管理

```go
// 如果需要运行 10 次查询，总 ε 预算为 1.0
epsilonPerQuery := 1.0 / 10.0  // 0.1

// 或者使用更高级的组合定理（未来版本）
```

## 🎯 真实世界应用

### 1. 医疗数据分析
```
场景: 发布某疾病的患病率统计
方法: DPCount + DPMean
隐私保护: 无法推断任何个人的健康状况
```

### 2. 金融报告
```
场景: 发布客户平均存款额
方法: DPMean
隐私保护: 无法推断任何个人的财务状况
```

### 3. 用户行为分析
```
场景: 统计功能使用频率
方法: DPCount
隐私保护: 无法确定特定用户是否使用该功能
```

## 🧪 交互式实验

### 实验 1: 观察噪声效果

运行多次相同的查询，观察输出变化：

```bash
# 运行 5 次
for i in {1..5}; do
    echo "Run $i:"
    make plugin-example-dpanonymizer | grep "Noisy value"
done
```

### 实验 2: 比较不同 Epsilon

修改示例代码中的 epsilon 值，观察：
- epsilon = 0.1: 噪声很大
- epsilon = 1.0: 噪声中等
- epsilon = 10.0: 噪声很小

### 实验 3: 边界的影响

尝试不同的边界设置：
- 宽边界: 更多噪声，无偏
- 窄边界: 更少噪声，可能有偏（如果数据超出边界）

## 📈 性能测试

### 基准测试

```bash
cd plugins/dpanonymizer/impl
go test -bench=. -benchmem
```

### 预期性能
- Laplace 噪声: ~1-2 μs/op
- Gaussian 噪声: ~2-3 μs/op
- DPCount: ~5-10 μs/op
- DPSum/Mean/Variance: ~10-20 μs/op

## 🔍 调试技巧

### 1. 验证隐私保证

```go
// 运行相同查询两次，一次包含某个用户，一次不包含
// 输出分布应该相似（差异由 ε 控制）
```

### 2. 检查噪声分布

```go
// 运行 1000 次，绘制直方图
// Laplace: 应该呈双指数分布
// Gaussian: 应该呈正态分布
```

### 3. 验证边界裁剪

```go
// 添加超出边界的值
// 验证它们被正确裁剪
```

## 🎓 学习路径

### 初学者
1. ✅ 运行示例程序
2. ✅ 理解 epsilon 的含义
3. ✅ 尝试不同的参数

### 中级
1. 理解敏感度计算
2. 学习隐私预算组合
3. 实现自己的 DP 查询

### 高级
1. 研究高级组合定理
2. 实现自适应隐私预算
3. 优化噪声参数

## 📞 获取帮助

- 查看 [README.md](README.md) 了解功能
- 查看 [USAGE.md](USAGE.md) 了解详细用法
- 查看 [Google DP 文档](https://github.com/google/differential-privacy)
- 提交 Issue 报告问题

---

**演示更新时间**: 2025-11-18

